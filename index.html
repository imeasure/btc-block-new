<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habfut BTC Professional Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* --- 全局样式设置 --- */
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background-color: #f8fafc; /* 专业浅灰背景 */
            color: #1e293b; /* 深色文字 */
        }
        .font-mono { font-family: 'Roboto Mono', monospace; } /* 数据专用等宽字体 */
        
        /* --- 专业卡片样式 --- */
        .pro-card { 
            background: #ffffff; 
            border: 1px solid #e2e8f0; /* 极细的灰色边框 */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); /* 柔和的商业阴影 */
        }
        
        /* --- 比特币渐变色 --- */
        .btc-gradient { background: linear-gradient(135deg, #f7931a 0%, #ffab40 100%); }
        
        /* --- 自定义滚动条 (更精致) --- */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- 交互过渡 --- */
        #auth-screen { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-card-shadow:hover { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.08); }
    </style>
</head>
<body class="antialiased overflow-x-hidden">

    <div id="auth-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-100/80 backdrop-blur-md">
        <div class="pro-card p-10 rounded-2xl shadow-xl text-center max-w-sm w-full mx-4 bg-white">
            <div class="w-16 h-16 btc-gradient rounded-xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-orange-500/20 transform rotate-3">
                <i class="fab fa-bitcoin text-3xl text-white"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2 text-slate-800">Habfut 情报终端</h2>
            <p class="text-slate-500 text-sm mb-8">请输入授权口令以访问数据流</p>
            <div class="relative">
                 <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                 <input type="password" id="pw" class="w-full bg-slate-50 border border-slate-200 p-3 pl-10 rounded-lg mb-4 focus:border-orange-500 focus:bg-white focus:ring-2 focus:ring-orange-200 outline-none transition font-mono text-slate-700 placeholder-slate-400" placeholder="Enter Passcode">
            </div>
            <button onclick="verify()" class="w-full btc-gradient py-3 rounded-lg font-semibold text-white hover:shadow-md hover:shadow-orange-500/20 active:scale-[0.98] transition">验证身份</button>
        </div>
    </div>

    <main id="main-content" class="hidden opacity-0 transition-opacity duration-700">
        <div class="container mx-auto px-4 py-6 lg:h-screen lg:overflow-hidden flex flex-col">
            
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 bg-white p-4 rounded-2xl pro-card">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 btc-gradient rounded-lg flex items-center justify-center shadow-sm">
                        <i class="fab fa-bitcoin text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight text-slate-800">HABFUT <span class="text-orange-600">INTELLIGENCE</span></h1>
                        <p class="text-slate-500 text-xs font-medium flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                            实时监控 / T+30m 更新
                        </p>
                    </div>
                </div>
                <div class="relative w-full md:w-80">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="searchInput" oninput="handleSearch()" placeholder="搜索区块高度 / TXID..." 
                           class="w-full bg-slate-50 border border-slate-200 pl-11 pr-4 py-2.5 rounded-xl focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500 focus:bg-white outline-none transition text-sm font-mono text-slate-700">
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 overflow-hidden">
                
                <div class="lg:col-span-4 space-y-6 overflow-y-auto custom-scrollbar pr-1">
                    <div class="pro-card p-6 rounded-2xl bg-white">
                        <h3 class="text-slate-600 text-xs font-bold uppercase tracking-wider mb-5 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i> 核心指标
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-slate-50 border border-slate-100 p-4 rounded-xl">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="text-slate-500 text-xs font-medium">最新区块高度</p>
                                    <i class="fas fa-cube text-slate-300"></i>
                                </div>
                                <p class="text-2xl font-bold text-slate-800 font-mono" id="stat-height">-</p>
                            </div>
                            <div class="bg-slate-50 border border-slate-100 p-4 rounded-xl">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="text-slate-500 text-xs font-medium">已捕获区块</p>
                                    <i class="fas fa-database text-slate-300"></i>
                                </div>
                                <p class="text-2xl font-bold text-orange-600 font-mono" id="stat-count">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pro-card p-5 rounded-2xl border-l-4 border-l-orange-500 bg-orange-50/30">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-orange-500 mt-1 mr-3"></i>
                            <div>
                                <p class="text-orange-800 text-sm font-bold mb-1">系统运行状态</p>
                                <p class="text-xs text-orange-700/70 leading-relaxed">GitHub Actions 托管后台服务，每 30 分钟尝试同步最新断点数据。数据流稳定。</p>
                            </div>
                        </div>
                    </div>

                    <div class="pro-card p-6 rounded-2xl bg-white">
                        <h3 class="text-slate-600 text-xs font-bold uppercase tracking-wider mb-4">操作指南</h3>
                         <ul class="text-sm text-slate-600 space-y-3 font-medium">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-3 bg-green-100 p-1 rounded-full text-xs"></i> 双屏视图，左侧概览右侧流水</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-3 bg-green-100 p-1 rounded-full text-xs"></i> 支持按高度或哈希实时检索</li>
                            <li class="flex items-center"><i class="fas fa-external-link-alt text-blue-500 mr-3 bg-blue-100 p-1 rounded-full text-xs"></i> 点击 TXID 直达 Mempool 浏览器</li>
                        </ul>
                    </div>
                </div>

                <div class="lg:col-span-8 flex flex-col pro-card rounded-2xl overflow-hidden bg-white">
                    <div class="px-6 py-4 border-b border-slate-200 bg-slate-50/50 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700 flex items-center">
                            <i class="fas fa-list-ul mr-2 text-slate-400"></i> 区块数据流
                        </h3>
                        <span class="text-xs bg-white border border-slate-200 text-slate-500 px-3 py-1 rounded-full font-medium shadow-sm">
                            实时更新中
                        </span>
                    </div>

                    <div id="block-list" class="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar bg-slate-100">
                        </div>
                    
                    <div class="p-4 border-t border-slate-200 flex justify-between items-center bg-white">
                        <button onclick="prevPage()" id="prevBtn" class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 hover:border-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition text-sm font-medium flex items-center">
                            <i class="fas fa-chevron-left mr-2 text-xs"></i> 上一页
                        </button>
                        <span id="pageInfo" class="text-sm font-bold text-slate-600 font-mono bg-slate-100 px-4 py-1 rounded-md">第 1 / 1 页</span>
                        <button onclick="nextPage()" id="nextBtn" class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50 hover:border-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition text-sm font-medium flex items-center">
                            下一页 <i class="fas fa-chevron-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        const pageSize = 20;

        function verify() {
            const val = document.getElementById('pw').value;
            // 这里是前端简单校验，实际生产环境建议后端校验
            if(val === 'habfut.com') {
                const authScreen = document.getElementById('auth-screen');
                authScreen.classList.add('opacity-0', 'scale-95'); // 添加缩放效果
                setTimeout(() => authScreen.remove(), 500); // 移除节点

                const main = document.getElementById('main-content');
                main.classList.remove('hidden');
                // 稍微延迟一点显示主内容，让过渡更平滑
                setTimeout(() => main.classList.add('opacity-100'), 100);
                init();
            } else {
                // 简单的错误提示动画
                const pwInput = document.getElementById('pw');
                pwInput.classList.add('ring-2', 'ring-red-500', 'animate-shake');
                setTimeout(() => pwInput.classList.remove('ring-2', 'ring-red-500', 'animate-shake'), 500);
            }
        }

        async function init() {
            try {
                // 模拟加载延迟，展示骨架屏效果（可选）
                // document.getElementById('block-list').innerHTML = '<div class="animate-pulse space-y-4">...骨架屏代码...</div>';
                
                const resp = await fetch('https://github.com/lovexw/btc-block-new/blob/main/data.json');
                if (!resp.ok) throw new Error('Network response was not ok');
                const data = await resp.json();
                
                // 数据容错处理
                allData = (data.history || []).reverse(); 
                filteredData = [...allData];
                
                document.getElementById('stat-height').innerText = data.last_height || '-';
                document.getElementById('stat-count').innerText = allData.length;
                
                render();
            } catch (e) {
                console.error("加载数据失败", e);
                document.getElementById('block-list').innerHTML = `
                    <div class="text-center py-20 text-slate-500 bg-white rounded-2xl border border-slate-200">
                        <i class="fas fa-exclamation-triangle text-4xl text-orange-400 mb-4"></i>
                        <p class="font-medium">无法读取 data.json 数据源</p>
                        <p class="text-xs mt-2">请确保 GitHub Actions 已成功运行并生成数据文件。</p>
                    </div>
                `;
            }
        }

        function render() {
            const list = document.getElementById('block-list');
            list.innerHTML = '';
            
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageItems = filteredData.slice(start, end);

            if(pageItems.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-20 text-slate-500 bg-white rounded-2xl border border-slate-200">
                        <i class="fas fa-search text-4xl text-slate-300 mb-4"></i>
                        <p class="font-medium">未找到相关区块数据</p>
                        <p class="text-xs mt-2">请尝试更换搜索关键词</p>
                    </div>
                `;
                updatePagination();
                return;
            }

            pageItems.forEach(block => {
                const blockDiv = document.createElement('div');
                // 使用专业卡片样式，并添加悬停效果
                blockDiv.className = 'pro-card p-5 rounded-xl bg-white transition-all duration-200 hover-card-shadow border-l-4 border-l-transparent hover:border-l-orange-500';
                
                let txsHtml = block.top_txs.map((tx, i) => {
                    // 前三名使用不同颜色的奖牌图标
                    let rankIcon = i === 0 ? 'text-yellow-500 fa-medal' : (i === 1 ? 'text-slate-400 fa-medal' : 'text-orange-700 fa-award');
                    
                    return `
                    <div class="flex flex-col md:flex-row md:items-center justify-between py-3 border-b border-slate-100 last:border-0 gap-2">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <span class="w-8 h-8 rounded-lg flex items-center justify-center bg-slate-50 text-sm font-bold ${i === 0 ? 'text-orange-600 bg-orange-50' : 'text-slate-600'}">
                                <i class="fas ${rankIcon}"></i>
                            </span>
                            <div class="flex flex-col truncate">
                                <span class="text-xs text-slate-400 font-medium">TXID</span>
                                <span class="text-sm font-mono text-slate-600 truncate md:w-80" title="${tx.txid}">${tx.txid}</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between md:justify-end gap-4 pl-11 md:pl-0">
                            <div class="text-right">
                                <span class="block text-lg font-bold text-slate-800 font-mono">${tx.value.toFixed(2)}</span>
                                <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full">BTC</span>
                            </div>
                            <a href="https://mempool.space/zh/tx/${tx.txid}" target="_blank" class="w-10 h-10 flex items-center justify-center rounded-lg bg-slate-50 text-slate-400 hover:bg-blue-50 hover:text-blue-600 transition border border-slate-200 group">
                                <i class="fas fa-external-link-alt text-sm group-hover:scale-110 transition-transform"></i>
                            </a>
                        </div>
                    </div>
                `}).join('');

                blockDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4 pb-3 border-b border-slate-100">
                        <h4 class="text-base font-bold flex items-center text-slate-800">
                            <span class="bg-slate-100 text-slate-600 p-2 rounded-lg mr-3">
                                <i class="fas fa-cube"></i>
                            </span>
                            <span class="font-mono text-lg">#${block.height}</span>
                        </h4>
                        <span class="text-[10px] bg-green-50 text-green-600 border border-green-200 px-2 py-1 rounded-md font-bold uppercase tracking-wider flex items-center">
                            <i class="fas fa-check-circle mr-1"></i> Confirmed
                        </span>
                    </div>
                    <div class="space-y-1">${txsHtml}</div>
                `;
                list.appendChild(blockDiv);
            });

            updatePagination();
            list.scrollTop = 0;
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / pageSize) || 1;
            document.getElementById('pageInfo').innerText = `第 ${currentPage} / ${totalPages} 页`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
        }

        function handleSearch() {
            const val = document.getElementById('searchInput').value.trim().toLowerCase();
            filteredData = allData.filter(b => 
                b.height.toString().includes(val) || 
                b.top_txs.some(t => t.txid.toLowerCase().includes(val))
            );
            currentPage = 1;
            render();
        }

        function prevPage() { if(currentPage > 1) { currentPage--; render(); } }
        function nextPage() { if(currentPage < Math.ceil(filteredData.length / pageSize)) { currentPage++; render(); } }

        // 添加回车键提交口令的功能
        document.getElementById('pw').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                verify();
            }
        });
    </script>
</body>
</html>
