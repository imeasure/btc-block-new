<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habfut BTC Professional Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background-color: #f8fafc; 
            color: #1e293b; 
        }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        .pro-card { 
            background: #ffffff; 
            border: 1px solid #e2e8f0; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        }
        .btc-gradient { background: linear-gradient(135deg, #f7931a 0%, #ffab40 100%); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        #auth-screen { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-card-shadow:hover { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.08); }
        .animate-shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="antialiased overflow-x-hidden">

    <div id="auth-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-100/80 backdrop-blur-md">
        <div class="pro-card p-10 rounded-2xl shadow-xl text-center max-w-sm w-full mx-4 bg-white">
            <div class="w-16 h-16 btc-gradient rounded-xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-orange-500/20 transform rotate-3">
                <i class="fab fa-bitcoin text-3xl text-white"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2 text-slate-800">Habfut 情报终端</h2>
            <p class="text-slate-500 text-sm mb-8">请输入授权口令以访问数据流</p>
            <div class="relative">
                 <i class="fas fa-lock absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                 <input type="password" id="pw" class="w-full bg-slate-50 border border-slate-200 p-3 pl-10 rounded-lg mb-4 focus:border-orange-500 focus:bg-white focus:ring-2 focus:ring-orange-200 outline-none transition font-mono text-slate-700" placeholder="Enter Passcode">
            </div>
            <button onclick="verify()" class="w-full btc-gradient py-3 rounded-lg font-semibold text-white hover:shadow-md transition">验证身份</button>
        </div>
    </div>

    <main id="main-content" class="hidden opacity-0 transition-opacity duration-700">
        <div class="container mx-auto px-4 py-6 lg:h-screen lg:overflow-hidden flex flex-col">
            
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 bg-white p-4 rounded-2xl pro-card">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 btc-gradient rounded-lg flex items-center justify-center">
                        <i class="fab fa-bitcoin text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight text-slate-800">HABFUT <span class="text-orange-600">INTELLIGENCE</span></h1>
                        <p class="text-slate-500 text-xs font-medium flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                            数据源：GitHub Raw (实时)
                        </p>
                    </div>
                </div>
                <div class="relative w-full md:w-80">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" id="searchInput" oninput="handleSearch()" placeholder="搜索区块高度 / TXID..." 
                           class="w-full bg-slate-50 border border-slate-200 pl-11 pr-4 py-2.5 rounded-xl focus:ring-2 focus:ring-orange-500/30 focus:border-orange-500 outline-none transition text-sm font-mono text-slate-700">
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 overflow-hidden">
                
                <div class="lg:col-span-4 space-y-6 overflow-y-auto custom-scrollbar pr-1">
                    <div class="pro-card p-6 rounded-2xl bg-white">
                        <h3 class="text-slate-600 text-xs font-bold uppercase tracking-wider mb-5 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i> 核心指标
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <p class="text-slate-500 text-xs mb-1">最新区块高度</p>
                                <p class="text-2xl font-bold text-slate-800 font-mono" id="stat-height">-</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <p class="text-slate-500 text-xs mb-1">历史监测总数</p>
                                <p class="text-2xl font-bold text-orange-600 font-mono" id="stat-count">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pro-card p-5 rounded-2xl border-l-4 border-l-orange-500 bg-orange-50/30">
                        <p class="text-orange-800 text-sm font-bold mb-1">同步状态</p>
                        <p class="text-xs text-orange-700/70">GitHub Actions 每 30 分钟同步一次断点。网页直接读取仓库最新原始数据。</p>
                    </div>

                    <div class="pro-card p-6 rounded-2xl bg-white">
                        <h3 class="text-slate-600 text-xs font-bold uppercase tracking-wider mb-4">HABFUT 使用建议</h3>
                        <ul class="text-sm text-slate-600 space-y-3">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-3 text-xs"></i> 连续性捕获，确保无遗漏</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-3 text-xs"></i> 重点关注单笔超过 1000 BTC 转账</li>
                        </ul>
                    </div>
                </div>

                <div class="lg:col-span-8 flex flex-col pro-card rounded-2xl overflow-hidden bg-white">
                    <div class="px-6 py-4 border-b border-slate-200 bg-slate-50/50 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700 font-mono"><i class="fas fa-stream mr-2 text-slate-400"></i> BLOCK_DATA_STREAM</h3>
                        <span class="text-[10px] bg-white border border-slate-200 text-slate-500 px-3 py-1 rounded-full font-bold">LIVE</span>
                    </div>

                    <div id="block-list" class="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar bg-slate-50">
                        </div>
                    
                    <div class="p-4 border-t border-slate-200 flex justify-between items-center bg-white">
                        <button onclick="prevPage()" id="prevBtn" class="px-4 py-2 border border-slate-200 rounded-lg hover:bg-slate-50 disabled:opacity-30 text-sm font-medium">上一页</button>
                        <span id="pageInfo" class="text-sm font-bold text-slate-600 font-mono">PAGE 1 / 1</span>
                        <button onclick="nextPage()" id="nextBtn" class="px-4 py-2 border border-slate-200 rounded-lg hover:bg-slate-50 disabled:opacity-30 text-sm font-medium">下一页</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        const pageSize = 20;

        function verify() {
            const val = document.getElementById('pw').value;
            if(val === 'habfut.com') {
                const authScreen = document.getElementById('auth-screen');
                authScreen.classList.add('opacity-0', 'scale-95');
                setTimeout(() => authScreen.remove(), 500);

                const main = document.getElementById('main-content');
                main.classList.remove('hidden');
                setTimeout(() => main.classList.add('opacity-100'), 100);
                init();
            } else {
                const pwInput = document.getElementById('pw');
                pwInput.classList.add('ring-2', 'ring-red-500', 'animate-shake');
                setTimeout(() => pwInput.classList.remove('ring-2', 'ring-red-500', 'animate-shake'), 500);
            }
        }

        async function init() {
            try {
                // 替换为你真实的 GitHub Raw 地址
                const githubRawUrl = 'https://raw.githubusercontent.com/lovexw/btc-block-new/refs/heads/main/data.json';
                const response = await fetch(githubRawUrl + '?t=' + new Date().getTime());
                
                if (!response.ok) throw new Error('Fetch Failed');
                const data = await response.json();
                
                allData = (data.history || []).reverse(); 
                filteredData = [...allData];
                
                document.getElementById('stat-height').innerText = data.last_height || '-';
                document.getElementById('stat-count').innerText = allData.length;
                
                render();
            } catch (e) {
                console.error(e);
                document.getElementById('block-list').innerHTML = `<div class="p-10 text-center text-slate-400">数据加载失败，请检查仓库权限或文件路径。</div>`;
            }
        }

        function render() {
            const list = document.getElementById('block-list');
            list.innerHTML = '';
            
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageItems = filteredData.slice(start, end);

            if(pageItems.length === 0) {
                list.innerHTML = `<div class="p-10 text-center text-slate-400">没有找到匹配的记录。</div>`;
                updatePagination();
                return;
            }

            pageItems.forEach(block => {
                const blockDiv = document.createElement('div');
                blockDiv.className = 'pro-card p-5 rounded-xl bg-white hover-card-shadow transition-all border-l-4 border-l-transparent hover:border-l-orange-500';
                
                let txsHtml = block.top_txs.map((tx, i) => `
                    <div class="flex flex-col md:flex-row md:items-center justify-between py-3 border-b border-slate-50 last:border-0">
                        <div class="flex items-center gap-3">
                            <span class="w-8 h-8 rounded bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500">#${i+1}</span>
                            <div class="flex flex-col">
                                <span class="text-[10px] text-slate-400 font-bold uppercase">TXID</span>
                                <span class="text-xs font-mono text-slate-600 truncate w-48 md:w-80">${tx.txid}</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between md:justify-end gap-6 mt-2 md:mt-0">
                            <div class="text-right">
                                <span class="text-base font-bold text-slate-800 font-mono">${tx.value.toFixed(2)}</span>
                                <span class="text-[10px] text-orange-600 font-bold ml-1">BTC</span>
                            </div>
                            <a href="https://mempool.space/zh/tx/${tx.txid}" target="_blank" class="w-8 h-8 flex items-center justify-center rounded bg-slate-50 text-slate-400 hover:bg-orange-500 hover:text-white transition">
                                <i class="fas fa-external-link-alt text-[10px]"></i>
                            </a>
                        </div>
                    </div>
                `).join('');

                blockDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-4 pb-2 border-b border-slate-50">
                        <h4 class="font-bold text-slate-800 font-mono tracking-tight underline decoration-orange-500/30 underline-offset-4">BLOCK #${block.height}</h4>
                        <span class="text-[9px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded border border-green-100">STABLE</span>
                    </div>
                    <div>${txsHtml}</div>
                `;
                list.appendChild(blockDiv);
            });

            updatePagination();
            list.scrollTop = 0;
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / pageSize) || 1;
            document.getElementById('pageInfo').innerText = `PAGE ${currentPage} / ${totalPages}`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
        }

        function handleSearch() {
            const val = document.getElementById('searchInput').value.trim().toLowerCase();
            filteredData = allData.filter(b => 
                b.height.toString().includes(val) || 
                b.top_txs.some(t => t.txid.toLowerCase().includes(val))
            );
            currentPage = 1;
            render();
        }

        function prevPage() { if(currentPage > 1) { currentPage--; render(); } }
        function nextPage() { if(currentPage < Math.ceil(filteredData.length / pageSize)) { currentPage++; render(); } }

        document.getElementById('pw').addEventListener('keypress', (e) => { if (e.key === 'Enter') verify(); });
    </script>
</body>
</html>
